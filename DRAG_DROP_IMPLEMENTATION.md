# カテゴリドラッグ&ドロップ並び替え機能 実装完了

## 実装内容

### 1. データベーススキーマ更新
- `Category`モデルに`sortOrder`フィールドを追加
- デフォルト値: 0
- 既存カテゴリのsortOrderを初期化

### 2. バックエンドAPI実装
- **GET /api/categories**: sortOrder順でカテゴリを取得
- **PUT /api/categories/reorder**: カテゴリ並び順を一括更新
  - トランザクションで安全に更新
  - バリデーション機能付き

### 3. フロントエンド実装
- **@dnd-kit**ライブラリを使用したドラッグ&ドロップ機能
- **カテゴリ管理ページ**: ドラッグハンドル付きのソート可能リスト
- **サイドバー**: sortOrder順でカテゴリを表示
- **楽観的更新**: ドラッグ中の即座のUI反映

### 4. 新しいAPIフック
- `useReorderCategories`: カテゴリ並び順更新用フック
- 楽観的更新とエラーハンドリング機能付き

### 5. テスト追加
- カテゴリ並び順更新APIのテスト
- 正常ケース、エラーケース、バリデーションテスト

## 使用方法

### カテゴリ管理ページ
1. `/categories`ページにアクセス
2. カテゴリカードの左側のドラッグハンドル（≡）をクリック
3. ドラッグ&ドロップで並び順を変更
4. 自動的にサーバーに保存される

### サイドバー
- カテゴリフィルタ部分で設定した並び順で表示される

## 技術詳細

### ライブラリ
- `@dnd-kit/core`: ドラッグ&ドロップのコア機能
- `@dnd-kit/sortable`: ソート可能リスト機能
- `@dnd-kit/utilities`: CSS変換ユーティリティ

### データフロー
1. ユーザーがドラッグ&ドロップ
2. フロントエンドで楽観的更新
3. バックエンドAPIに並び順データを送信
4. データベースでトランザクション実行
5. 成功時: キャッシュ更新、失敗時: ロールバック

### エラーハンドリング
- 存在しないカテゴリIDの検証
- ネットワークエラー時の自動ロールバック
- ユーザーフレンドリーなエラーメッセージ

## 完了状況
✅ データベーススキーマ更新
✅ バックエンドAPI実装
✅ フロントエンド実装
✅ テスト追加
✅ 全テスト通過確認

カテゴリのドラッグ&ドロップ並び替え機能が完全に実装されました！