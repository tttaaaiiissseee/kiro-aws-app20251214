# 本番環境用の設定

services:
  frontend:
    build:
      target: production
    volumes:
      # 本番環境では開発用ボリュームを削除
      - frontend_cache:/var/cache/nginx
    environment:
      - NODE_ENV=production
    restart: always

  backend:
    build:
      target: production
    volumes:
      # 本番環境では開発用ボリュームを削除
      - sqlite_data:/app/prisma:rw
      - uploads_data:/app/uploads:rw
      - backend_cache:/app/.cache:rw
    environment:
      - NODE_ENV=production
      - LOG_LEVEL=warn
    restart: always
    command: ["node", "dist/index.js"]

  nginx:
    profiles:
      - production
    restart: always
    environment:
      - NGINX_WORKER_PROCESSES=auto
      - NGINX_WORKER_CONNECTIONS=1024